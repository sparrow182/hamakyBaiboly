{% extends "base.html.twig" %}

{% block body %}

    {{ form(formSearch) }}

    <section>
        {% if searchResults is defined and searchResults | length > 0 %}
            <h2>{{ 'search.result' | trans }}</h2>

            <h3>{{ 'search.book' | trans }} : {{ formData.book ? formData.book.nameMg : "" }}</h3>

            {% for content in searchResults %}
                <p><strong>{{ content.chapter }}</strong>-<strong>{{ content.verse }}.</strong> {{ content.text }}</p>
            {% endfor %}
        {% endif %}
    </section>

{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script>

        $(function () {

            var $sport = $('#bible_search_book');
            // When sport gets selected ...
            $sport.change(function () {
                // ... retrieve the corresponding form.
                var $form = $(this).closest('form');
                // Simulate form data, but only include the selected sport value.
                var data = {};
                data[$sport.attr('name')] = $sport.val();
                // Submit data via AJAX to the form's action path.
                $.ajax({
                    url: $form.attr('action'),
                    type: $form.attr('method'),
                    data: data,
                    success: function (html) {
                        // Replace current position field ...
                        $('#bible_search_chapter').replaceWith(
                                // ... with the returned one from the AJAX response.
                                $(html).find('#bible_search_chapter'));
                        // Position field now displays the appropriate positions.
                    }
                });
            });


        {#function loadChaptersByBook(targetURL) {

            return $.ajax({
                url: targetURL,
                type: "get",
            });
        }

        $('#bible_search_book').change(function (e) {

            if ($(this).val()) {
                var path = '{{ path('defi_page_ajax_load_chapters_by_book', { bookId : 'bid' }) }}';
                path = path.replace('bid', $(this).val());

                loadChaptersByBook(path).done(function (data) {
                    $('#bible_search_chapter').html(data);
                });
            }

        });#}

            });
    </script>

{% endblock %}
